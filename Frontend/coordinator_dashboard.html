<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AttendNet Coordinator Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/dashboard-styles.css" />
    <link rel="stylesheet" href="css/dark-theme.css" />
    <link rel="stylesheet" href="css/scan-results.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <!-- Navbar -->
    <div class="navbar-custom">
      <div class="navbar-left">
        <button class="hamburger-btn" id="hamburgerBtn" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="navbar-tabs" id="navbarTabs">
          <a href="#" class="nav-link" data-tab="reports">
            <i class="fas fa-chart-bar"></i> <span>Reports</span>
          </a>
          <a href="#" class="nav-link" data-tab="session-history">
            <i class="fas fa-history"></i> <span>Session History</span>
          </a>
          <a href="#" class="nav-link" data-tab="sessions">
            <i class="fas fa-calendar"></i> <span>Sessions</span>
          </a>
          <a href="#" class="nav-link" data-tab="settings">
            <i class="fas fa-cog"></i> <span>Settings</span>
          </a>
        </div>
      </div>
      <div class="navbar-right">
        <div class="coordinator-info">
          <div class="coordinator-profile">
            <div class="profile-avatar" id="profileAvatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="coordinator-details">
              <div class="coordinator-name" id="coordNameDisplay">
                Coordinator
              </div>
              <div class="coordinator-email" id="coordEmailDisplay">
                email@example.com
              </div>
            </div>
          </div>
        </div>
        <button
          class="profile-menu-btn"
          id="profileMenuBtn"
          aria-label="Profile"
        >
          <i class="fas fa-chevron-down"></i>
        </button>

        <!-- theme toggle -->
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>

      <!-- Profile Dropdown Menu -->
      <div class="profile-dropdown" id="profileDropdown">
        <a href="#" class="dropdown-item" id="settingsLink" data-tab="settings">
          <i class="fas fa-cog"></i> Settings
        </a>
        <a href="#" class="dropdown-item" id="logoutLink">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Content Area -->
      <div class="content-area">
        <!-- Reports Tab -->
        <div id="reports" class="tab-content active">
          <div class="page-title">Attendance Report</div>
          <div class="welcome-section">
            <div class="welcome-icon">
              <i class="fas fa-hand-wave"></i>
            </div>
            <h1 class="welcome-message">
              Welcome back, <span id="welcomeName">Coordinator</span>! ðŸ‘‹
            </h1>
            <p class="welcome-subtitle">
                Let's check in the students' attendance. <p></p>
              Detailed overview of student attendance records, filters, and
              actions.
            </p>
          </div>

          <!-- Statistics Cards -->
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-value" id="totalStudents">0</div>
              <div class="stat-label">Total Students</div>
              <div class="stat-sublabel">Registered in the system</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="color: #28a745">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-value" id="totalPresent">0</div>
              <div class="stat-label">Total Present</div>
              <div class="stat-sublabel">Students marked present</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="color: #dc3545">
                <i class="fas fa-times-circle"></i>
              </div>
              <div class="stat-value" id="totalAbsent">0</div>
              <div class="stat-label">Total Absent</div>
              <div class="stat-sublabel">Students had had absent</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="color: #ffc107">
                <i class="fas fa-percent"></i>
              </div>
              <div class="stat-value" id="attendanceRate">0%</div>
              <div class="stat-label">Attendance Rate</div>
              <div class="stat-sublabel">Average for selected period</div>
            </div>
          </div>

          <!-- Filter Section -->
          <div class="filter-section">
            <div class="filter-title">
              <i class="fas fa-filter"></i> Filter Attendance
            </div>
            <div class="filter-row">
              <div class="filter-group">
                <label for="filterDate">Date</label>
                <input type="date" id="filterDate" />
              </div>
              <div class="filter-group">
                <label for="filterCourse">Course</label>
                <select id="filterCourse">
                  <option value="">All Courses</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="filterSession">Session</label>
                <select id="filterSession">
                  <option value="">All Sessions</option>
                </select>
              </div>
            </div>
            <div class="filter-buttons">
              <button
                class="btn-custom btn-primary-custom"
                id="previewEmailBtn"
              >
                <i class="fas fa-eye"></i> Preview Email
              </button>
              <button class="btn-custom btn-secondary-custom" id="exportPdfBtn">
                <i class="fas fa-file-pdf"></i> Export PDF
              </button>
              <button class="btn-custom btn-primary-custom" id="sendEmailBtn">
                <i class="fas fa-paper-plane"></i> Send Email
              </button>
            </div>
          </div>

          <!-- Table Section -->
          <div class="table-section">
            <div class="table-title">
              <i class="fas fa-table"></i> Detailed Attendance Records
            </div>
            <div class="table-subtitle">
              View and manage individual student attendance.
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Student Name</th>
                    <th>Department</th>
                    <th>Course</th>
                    <th>Scans</th>
                    <th>Rate</th>
                    <th>Status</th>
                    <th>Timestamp</th>
                  </tr>
                </thead>
                <tbody id="attendanceTableBody">
                  <tr>
                    <td colspan="7" style="text-align: center; color: #999">
                      No attendance records found
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="pagination-custom">
              <button class="pagination-btn" id="prevBtn">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span id="pageInfo">Page 1</span>
              <button class="pagination-btn" id="nextBtn">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sessions Tab -->
        <div id="sessions" class="tab-content">
          <div class="page-title">Create Session</div>
          <div class="page-subtitle">Set up a new attendance session</div>

          <div class="session-form">
            <form id="sessionForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="course">Course Name</label>
                  <input
                    type="text"
                    id="course"
                    placeholder="e.g., Mathematics I"
                  />
                </div>
                <div class="form-group">
                  <label for="date">Date</label>
                  <input type="date" id="date" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="startTime">Start Time</label>
                  <input type="time" id="startTime" />
                </div>
                <div class="form-group">
                  <label for="endTime">End Time</label>
                  <input type="time" id="endTime" />
                </div>
              </div>
              <div class="form-group">
                <label for="departmentSelect">Select Departments</label>
                <div class="custom-dropdown-container">
                  <button type="button" id="departmentToggle" class="custom-dropdown-button">
                    <span id="selectedText">Select departments...</span>
                    <i class="fas fa-chevron-down" style="margin-left: 0.5rem;"></i>
                  </button>
                  <div id="departmentDropdown" class="custom-dropdown-menu" style="display: none;">
                    <div class="dropdown-item select-all" data-value="__all__">
                      <i class="fas fa-check-double"></i>
                      <span>Select All</span>
                    </div>
                    <div class="dropdown-divider"></div>
                    <!-- Department options will be added here by JavaScript -->
                  </div>
                </div>
                <input type="hidden" id="departments" />
              </div>

              <!-- Scan interval option -->
              <div class="form-group">
                <label for="interval">Scan Interval (minutes)</label>
                <input
                  type="number"
                  id="interval"
                  min="0"
                  value="5"
                  placeholder="0 for manual"
                />
                <small style="color:#666; display:block; margin-top:0.25rem;">
                  Enter 0 to require manual scans after the session starts; the system still performs an initial scan when the session begins.  Use a positive number to have the system automatically repeat scans at that many minutes (default 5).
                </small>
              </div>

              <!-- Auto-scan status -->
              <div class="form-group" id="autoScanStatus" style="display: none;">
                <label>Auto-Scan Status</label>
                <div class="auto-scan-info">
                  <div class="scan-status-indicator" id="scanStatusIndicator">
                    <i class="fas fa-pause-circle"></i>
                    <span id="scanStatusText">Not Active</span>
                  </div>
                  <div class="scan-countdown" id="scanCountdown">
                    <i class="fas fa-clock"></i>
                    <span id="scanCountdownText">--:--</span>
                  </div>
                  <div class="scan-actions">
                    <button type="button" class="btn-custom btn-success-custom" id="startAutoScan" onclick="resumeAutoScanForCurrentSession()">
                      <i class="fas fa-play"></i> Resume Auto-Scan
                    </button>
                    <button type="button" class="btn-custom btn-danger-custom" id="stopAutoScan" onclick="stopAutoScanForCurrentSession()" style="display: none;">
                      <i class="fas fa-pause"></i> Pause Auto-Scan
                    </button>
                  </div>
                </div>
              </div>

              <button type="submit" class="btn-custom btn-primary-custom">
                <i class="fas fa-plus"></i> Create Session
              </button>
            </form>
          </div>

          <!-- Attendance Scan Section -->
          <div class="scan-section">
            <div id="countdownContainer" style="display: none; margin-bottom: 1rem;">
              <div style="padding: 1rem; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <div>
                    <i class="fas fa-clock" style="color: #2196f3; margin-right: 0.5rem;"></i>
                    <span style="font-weight: 600; color: #1976d2;">Next automatic scan in:</span>
                    <span id="countdownTimer" style="font-size: 1.2rem; font-weight: bold; color: #2196f3; margin-left: 0.5rem;">00:00</span>
                  </div>
                  <button id="cancelScanBtn" class="btn-custom btn-secondary-custom" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">
                    <i class="fas fa-stop"></i> Cancel Auto-Scan
                  </button>
                </div>
              </div>
            </div>
            <div id="resultsContainer"></div>
          </div>

          <!-- Session list area -->
          <div class="session-list" id="sessionListContainer">
            <h4>Upcoming Sessions</h4>
            <div id="upcomingSessions">
              <div id="noUpcomingSessions" style="text-align: center; color: #999">
                No upcoming sessions found
              </div>
            </div>
            <h4 style="margin-top:2rem;">Active Sessions</h4>
            <div id="activeSessions">
              no active sessions found
            </div>
            <h4 style="margin-top:2rem;">Ended Sessions</h4>
  
            <div id="endedSessions"></div>
          </div>
        </div>

        <!-- Session History Tab -->
        <div id="session-history" class="tab-content">
          <div class="page-title">Session History</div>
          <div class="page-subtitle">View detailed reports of past sessions</div>

          <!-- Session Summary Statistics -->
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-value" id="totalSessions">0</div>
              <div class="stat-label">Total Sessions</div>
              <div class="stat-sublabel">Sessions completed</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="color: #28a745">
                <i class="fas fa-user-check"></i>
              </div>
              <div class="stat-value" id="totalStudentsHist">0</div>
              <div class="stat-label">Total Students</div>
              <div class="stat-sublabel">Across all sessions</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="color: #ffc107">
                <i class="fas fa-percentage"></i>
              </div>
              <div class="stat-value" id="avgAttendanceRate">0%</div>
              <div class="stat-label">Avg Attendance</div>
              <div class="stat-sublabel">Across all sessions</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="color: #17a2b8">
                <i class="fas fa-qrcode"></i>
              </div>
              <div class="stat-value" id="totalScans">0</div>
              <div class="stat-label">Total Scans</div>
              <div class="stat-sublabel">Scans performed</div>
            </div>
          </div>

          <!-- Session History Filters -->
          <div class="filter-section">
            <div class="filter-title">
              <i class="fas fa-filter"></i> Filter Sessions
            </div>
            <div class="filter-row">
              <div class="filter-group">
                <label for="historyDateFrom">From Date</label>
                <input type="date" id="historyDateFrom" />
              </div>
              <div class="filter-group">
                <label for="historyDateTo">To Date</label>
                <input type="date" id="historyDateTo" />
              </div>
              <div class="filter-group">
                <label for="historyDepartment">Department</label>
                <select id="historyDepartment">
                  <option value="">All Departments</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="historyCourse">Course</label>
                <input type="text" id="historyCourse" placeholder="Search courses..." />
              </div>
            </div>
            <div class="filter-buttons">
              <button class="btn-custom btn-primary-custom" id="applyHistoryFilters">
                <i class="fas fa-search"></i> Apply Filters
              </button>
              <button class="btn-custom btn-secondary-custom" id="clearHistoryFilters">
                <i class="fas fa-times"></i> Clear
              </button>
            </div>
          </div>

          <!-- Session History Table -->
          <div class="table-section">
            <div class="table-title">
              <i class="fas fa-history"></i> Past Sessions
            </div>
            <div class="table-subtitle">
              Click on a session to view detailed attendance records.
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Course</th>
                    <th>Time</th>
                    <th>Departments</th>
                    <th>Students</th>
                    <th>Present</th>
                    <th>Absent</th>
                    <th>Rate</th>
                    <th>Scans</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="sessionHistoryTableBody">
                  <tr>
                    <td colspan="10" style="text-align: center; color: #999">
                      No session history found
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="pagination-custom">
              <button class="pagination-btn" id="historyPrevBtn">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <span id="historyPageInfo">Page 1</span>
              <button class="pagination-btn" id="historyNextBtn">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
          <div class="page-title">Settings</div>
          <div class="page-subtitle">Manage your account and preferences</div>
          <div class="session-form">
            <div class="form-group">
              <label>Account Information</label>
              <p style="color: #666">
                Coordinator ID: <span id="coordId">-</span>
              </p>
              <p style="color: #666">Email: <span id="coordEmail">-</span></p>
            </div>
            <button class="btn-custom btn-secondary-custom" id="logoutBtn">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      Â© 2026 School Attendance Tracker. All rights reserved.
    </div>

    <!-- Department Management Modal -->
    <div class="modal fade" id="departmentModal" tabindex="-1" aria-labelledby="departmentModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="departmentModalLabel">Manage Departments</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="sessionCourseDisplay" class="form-label">Session</label>
              <input type="text" class="form-control" id="sessionCourseDisplay" readonly>
            </div>
            <div class="mb-3">
              <label for="currentDepartments" class="form-label">Current Departments</label>
              <div id="currentDepartments" class="department-tags-container"></div>
            </div>
            <div class="mb-3">
              <label for="availableDepartments" class="form-label">Available Departments</label>
              <div id="availableDepartments" class="department-tags-container"></div>
            </div>
            <div class="mb-3">
              <label for="newDepartment" class="form-label">Add New Department</label>
              <div class="input-group">
                <input type="text" class="form-control" id="newDepartment" placeholder="Enter department name">
                <button class="btn btn-primary" type="button" onclick="addNewDepartment()">
                  <i class="fas fa-plus"></i> Add
                </button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveDepartmentChanges()">Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Session Modal -->
    <div class="modal fade" id="editSessionModal" tabindex="-1" aria-labelledby="editSessionModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editSessionModalLabel">Edit Session</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editSessionForm">
              <div class="mb-3">
                <label for="editCourse" class="form-label">Course Name</label>
                <input type="text" class="form-control" id="editCourse" required>
              </div>
              <div class="mb-3">
                <label for="editDate" class="form-label">Date</label>
                <input type="date" class="form-control" id="editDate" required>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editStartTime" class="form-label">Start Time</label>
                  <input type="time" class="form-control" id="editStartTime" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editEndTime" class="form-label">End Time</label>
                  <input type="time" class="form-control" id="editEndTime" required>
                </div>
              </div>
              <div class="mb-3">
                <label for="editInterval" class="form-label">Scan Interval (minutes)</label>
                <input type="number" class="form-control" id="editInterval" min="0" value="5">
                <small class="form-text text-muted">Enter 0 for manual scans only</small>
              </div>
              <input type="hidden" id="editSessionId">
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="updateSession()">Update Session</button>
          </div>
        </div>
      </div>
    </div>

    <script src="js/config.js"></script>
    <!-- socket.io client from CDN -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/dashboard.js"></script>
  </body>
</html>
